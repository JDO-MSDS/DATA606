---
title: "Data 606 Lab 6"
author: "Joao De Oliveira"
date: "2025-10-14"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Overview
In this lab, we will explore and visualize the data using the tidyverse suite of packages, and perform statistical inference using infer. The data can be found in the companion package for OpenIntro resources, openintro.


### Load Packages

```{r packages}
library(tidyverse)
library(openintro)
library(infer)
```


### Exercise 1
What are the counts within each category for the amount of days these students have texted while driving within the past 30 days?


```{r data and exercise1}
data(yrbss)

glimpse(yrbss)

yrbss %>%
  count(text_while_driving_30d) %>%
  arrange(desc(n))
```

### Answer 1
As we can see in the output, the count of high school students that claimed to never text while driving (0) in the past 30 days is 4792, 925 claimed to have done it between 1 and times, 493 did it between 3 and 5 times, 311 between 6 and 9 times, 373 between 10 and 19 times, 298 between 20 and 29 times, 827 claimed to have done it every day in the last 30 days, 4646 didn't drive in the past month, and 918 didn't answer or didn't know. This shows that the great majority claimed to never text while driving or they just didn't drive in that period. However, there are still high students who text while drive (827 every single day!).


### Exercise 2
What is the proportion of people who have texted while driving every day in the past 30 days and never wear helmets?

```{r exercise 2}
no_helmet <- yrbss %>%
  filter(helmet_12m == "never")

no_helmet <- no_helmet %>%
  mutate(text_ind = ifelse(text_while_driving_30d == "30", "yes", "no"))

no_helmet %>%
  count(text_ind) %>%
  mutate(proportion = 100 * (n / sum(n)))
```

### Answer 2
By looking at the output table, we can see that 86.6% who never wear helmets claim to not have texted, while 6.64 % did not wear helmet and texted while driving.


### Exercise 3
What is the margin of error for the estimate of the proportion of non-helmet wearers that have texted while driving each day for the past 30 days based on this survey?

```{r exercise3}
no_helmet %>%
  filter(text_ind %in% c("yes", "no")) %>%
  specify(response = text_ind, success = "yes") %>%
  generate(reps = 1000, type = "bootstrap") %>%
  calculate(stat = "prop") %>%
  get_ci(level = 0.95) %>%
  mutate(ME = (upper_ci - lower_ci) / 2)
```

### Answer 3
The margin of error, as we can see in the output, is 0.00654 or 0.654 percentage points (comparing both percentages).


### Exercise 4
Using the infer package, calculate confidence intervals for two other categorical variables (you’ll need to decide which level to call “success”, and report the associated margins of error. Interpet the interval in context of the data. It may be helpful to create new data sets for each of the two countries first, and then use these data sets to construct the confidence intervals.

```{r exercise4}
unique(yrbss$hours_tv_per_school_day)
unique(yrbss$school_night_hours_sleep)

# success is watching less than 2h of tv
# Looking at the unique values, we need to match the actual levels in the data
tv_hours_df <- yrbss %>%
  filter(!is.na(hours_tv_per_school_day)) %>%
  mutate(success = if_else(hours_tv_per_school_day %in% c("do not watch","<1","1","2"), "yes", "no")) %>%
  mutate(success = factor(success, levels = c("no","yes")))

# Check the data
table(tv_hours_df$success)
prop.table(table(tv_hours_df$success))

# Manual bootstrap for TV hours
set.seed(123)
n_reps <- 1000
bootstrap_props <- replicate(n_reps, {
  sample_data <- sample(tv_hours_df$success, size = nrow(tv_hours_df), replace = TRUE)
  mean(sample_data == "yes")
})

ci_tv_low <- data.frame(
  lower_ci = quantile(bootstrap_props, 0.025),
  upper_ci = quantile(bootstrap_props, 0.975)
) %>%
  mutate(ME = (upper_ci - lower_ci) / 2)

p_hat_tv <- mean(tv_hours_df$success == "yes")

ci_tv_low
p_hat_tv

# success is sleeping 8h or more
# Looking at the unique values, we need to match the actual levels in the data
sleep_hours_df <- yrbss %>%
  filter(!is.na(school_night_hours_sleep)) %>%
  mutate(success = if_else(school_night_hours_sleep %in% c("8","9","10+"), "yes", "no")) %>%
  mutate(success = factor(success, levels = c("no","yes")))

# Check the data
table(sleep_hours_df$success)
prop.table(table(sleep_hours_df$success))

# Manual bootstrap for sleep hours
set.seed(1234)
bootstrap_props_sleep <- replicate(n_reps, {
  sample_data <- sample(sleep_hours_df$success, size = nrow(sleep_hours_df), replace = TRUE)
  mean(sample_data == "yes")
})

ci_sleep_enough <- data.frame(
  lower_ci = quantile(bootstrap_props_sleep, 0.025),
  upper_ci = quantile(bootstrap_props_sleep, 0.975)
) %>%
  mutate(ME = (upper_ci - lower_ci) / 2)

p_hat_sleep <- mean(sleep_hours_df$success == "yes")

ci_sleep_enough
p_hat_sleep

# Check proportions in each dataset
table(tv_hours_df$success)
table(sleep_hours_df$success)

```